let decodedPolygon = require('../geo_json_decode_and_encode').decodePolygon;
let encodePolygon = require('../geo_json_decode_and_encode').encodePolygon;

let encodedJingan = {
	"coordinate": "@@DOACU@BGSGQCELAJABIECBBNFHJB\\PNKD@JHFM",
	"encodeOffsets": [
		124382,
		31984
	]
};

let encodedZhabei = {
	"coordinate": "@@ASG@BOCKCEBA@G@KBEDCLMVQ@EACDECABCDKECGDMEKFIGC@ONDF@FB@@DC@BHOVUJCFIGA@@RCJBNG@ABBDBB@DNBAJJ@@FB@@H@@@DF@ENB@BDD@BAT@BENDFDPB@AF@@G",
	"encodeOffsets": [
		124384,
		32068
	]
};

let decodedJinganCoordinates = decodedPolygon(encodedJingan.coordinate, encodedJingan.encodeOffsets);
// console.log('decodedJinganCoordinates:', decodedJinganCoordinates);
/*[ [ 121.466796875, 31.234375 ],
	[ 121.46875, 31.2265625 ],
	[ 121.4677734375, 31.224609375 ],
	[ 121.45703125, 31.224609375 ],
	[ 121.4580078125, 31.220703125 ],
	[ 121.4482421875, 31.216796875 ],
	[ 121.439453125, 31.21484375 ],
	[ 121.4365234375, 31.220703125 ],
	[ 121.435546875, 31.2255859375 ],
	[ 121.4345703125, 31.2265625 ],
	[ 121.4296875, 31.2236328125 ],
	[ 121.427734375, 31.224609375 ],
	[ 121.4287109375, 31.2314453125 ],
	[ 121.431640625, 31.2353515625 ],
	[ 121.4365234375, 31.236328125 ],
	[ 121.4501953125, 31.244140625 ],
	[ 121.45703125, 31.23828125 ],
	[ 121.458984375, 31.23828125 ],
	[ 121.4638671875, 31.2421875 ],
	[ 121.466796875, 31.2353515625 ] ]*/
let decodedZhabeiCoordinates = decodedPolygon(encodedZhabei.coordinate, encodedZhabei.encodeOffsets);
// console.log('decodedZhabeiCoordinates:', decodedZhabeiCoordinates);
// [ [ 121.46875, 31.31640625 ],
// 	[ 121.4677734375, 31.306640625 ],
// 	[ 121.4638671875, 31.306640625 ],
// 	[ 121.46484375, 31.298828125 ],
// 	[ 121.462890625, 31.29296875 ],
// 	[ 121.4609375, 31.2900390625 ],
// 	[ 121.4619140625, 31.2890625 ],
// 	[ 121.4619140625, 31.28515625 ],
// 	[ 121.4619140625, 31.279296875 ],
// 	[ 121.462890625, 31.2763671875 ],
// 	[ 121.46484375, 31.2744140625 ],
// 	[ 121.470703125, 31.267578125 ],
// 	[ 121.4814453125, 31.2587890625 ],
// 	[ 121.4814453125, 31.255859375 ],
// 	[ 121.48046875, 31.25390625 ],
// 	[ 121.482421875, 31.2509765625 ],
// 	[ 121.48046875, 31.25 ],
// 	[ 121.4814453125, 31.248046875 ],
// 	[ 121.4833984375, 31.2421875 ],
// 	[ 121.48046875, 31.240234375 ],
// 	[ 121.4765625, 31.2421875 ],
// 	[ 121.4697265625, 31.2392578125 ],
// 	[ 121.4638671875, 31.2421875 ],
// 	[ 121.458984375, 31.23828125 ],
// 	[ 121.45703125, 31.23828125 ],
// 	[ 121.44921875, 31.2451171875 ],
// 	[ 121.451171875, 31.248046875 ],
// 	[ 121.451171875, 31.2509765625 ],
// 	[ 121.4521484375, 31.2509765625 ],
// 	[ 121.4521484375, 31.2529296875 ],
// 	[ 121.4501953125, 31.2529296875 ],
// 	[ 121.451171875, 31.2568359375 ],
// 	[ 121.443359375, 31.267578125 ],
// 	[ 121.4326171875, 31.2724609375 ],
// 	[ 121.4306640625, 31.275390625 ],
// 	[ 121.42578125, 31.271484375 ],
// 	[ 121.4248046875, 31.271484375 ],
// 	[ 121.4248046875, 31.2802734375 ],
// 	[ 121.4228515625, 31.28515625 ],
// 	[ 121.423828125, 31.2919921875 ],
// 	[ 121.419921875, 31.2919921875 ],
// 	[ 121.4189453125, 31.29296875 ],
// 	[ 121.419921875, 31.294921875 ],
// 	[ 121.4208984375, 31.2958984375 ],
// 	[ 121.4208984375, 31.2978515625 ],
// 	[ 121.427734375, 31.298828125 ],
// 	[ 121.4267578125, 31.3037109375 ],
// 	[ 121.431640625, 31.3037109375 ],
// 	[ 121.431640625, 31.306640625 ],
// 	[ 121.4326171875, 31.306640625 ],
// 	[ 121.4326171875, 31.310546875 ],
// 	[ 121.4326171875, 31.310546875 ],
// 	[ 121.4326171875, 31.3125 ],
// 	[ 121.435546875, 31.3125 ],
// 	[ 121.4326171875, 31.3193359375 ],
// 	[ 121.43359375, 31.3193359375 ],
// 	[ 121.4345703125, 31.3212890625 ],
// 	[ 121.4365234375, 31.3212890625 ],
// 	[ 121.4375, 31.3203125 ],
// 	[ 121.447265625, 31.3203125 ],
// 	[ 121.4482421875, 31.3173828125 ],
// 	[ 121.455078125, 31.3193359375 ],
// 	[ 121.4580078125, 31.3212890625 ],
// 	[ 121.4658203125, 31.322265625 ],
// 	[ 121.4658203125, 31.3212890625 ],
// 	[ 121.46875, 31.3212890625 ],
// 	[ 121.46875, 31.3173828125 ] ]


let mergedCoordinates = mergeCoordinates(decodedJinganCoordinates, decodedZhabeiCoordinates);
// console.log('mergedCoordinates:', mergedCoordinates);
/*[ [ 121.466796875, 31.234375 ],
	[ 121.46875, 31.2265625 ],
	[ 121.4677734375, 31.224609375 ],
	[ 121.45703125, 31.224609375 ],
	[ 121.4580078125, 31.220703125 ],
	[ 121.4482421875, 31.216796875 ],
	[ 121.439453125, 31.21484375 ],
	[ 121.4365234375, 31.220703125 ],
	[ 121.435546875, 31.2255859375 ],
	[ 121.4345703125, 31.2265625 ],
	[ 121.4296875, 31.2236328125 ],
	[ 121.427734375, 31.224609375 ],
	[ 121.4287109375, 31.2314453125 ],
	[ 121.431640625, 31.2353515625 ],
	[ 121.4365234375, 31.236328125 ],
	[ 121.4501953125, 31.244140625 ],
	[ 121.44921875, 31.2451171875 ],
	[ 121.451171875, 31.248046875 ],
	[ 121.451171875, 31.2509765625 ],
	[ 121.4521484375, 31.2509765625 ],
	[ 121.4521484375, 31.2529296875 ],
	[ 121.4501953125, 31.2529296875 ],
	[ 121.451171875, 31.2568359375 ],
	[ 121.443359375, 31.267578125 ],
	[ 121.4326171875, 31.2724609375 ],
	[ 121.4306640625, 31.275390625 ],
	[ 121.42578125, 31.271484375 ],
	[ 121.4248046875, 31.271484375 ],
	[ 121.4248046875, 31.2802734375 ],
	[ 121.4228515625, 31.28515625 ],
	[ 121.423828125, 31.2919921875 ],
	[ 121.419921875, 31.2919921875 ],
	[ 121.4189453125, 31.29296875 ],
	[ 121.419921875, 31.294921875 ],
	[ 121.4208984375, 31.2958984375 ],
	[ 121.4208984375, 31.2978515625 ],
	[ 121.427734375, 31.298828125 ],
	[ 121.4267578125, 31.3037109375 ],
	[ 121.431640625, 31.3037109375 ],
	[ 121.431640625, 31.306640625 ],
	[ 121.4326171875, 31.306640625 ],
	[ 121.4326171875, 31.310546875 ],
	[ 121.4326171875, 31.310546875 ],
	[ 121.4326171875, 31.3125 ],
	[ 121.435546875, 31.3125 ],
	[ 121.4326171875, 31.3193359375 ],
	[ 121.43359375, 31.3193359375 ],
	[ 121.4345703125, 31.3212890625 ],
	[ 121.4365234375, 31.3212890625 ],
	[ 121.4375, 31.3203125 ],
	[ 121.447265625, 31.3203125 ],
	[ 121.4482421875, 31.3173828125 ],
	[ 121.455078125, 31.3193359375 ],
	[ 121.4580078125, 31.3212890625 ],
	[ 121.4658203125, 31.322265625 ],
	[ 121.4658203125, 31.3212890625 ],
	[ 121.46875, 31.3212890625 ],
	[ 121.46875, 31.3173828125 ],
	[ 121.46875, 31.31640625 ],
	[ 121.4677734375, 31.306640625 ],
	[ 121.4638671875, 31.306640625 ],
	[ 121.46484375, 31.298828125 ],
	[ 121.462890625, 31.29296875 ],
	[ 121.4609375, 31.2900390625 ],
	[ 121.4619140625, 31.2890625 ],
	[ 121.4619140625, 31.28515625 ],
	[ 121.4619140625, 31.279296875 ],
	[ 121.462890625, 31.2763671875 ],
	[ 121.46484375, 31.2744140625 ],
	[ 121.470703125, 31.267578125 ],
	[ 121.4814453125, 31.2587890625 ],
	[ 121.4814453125, 31.255859375 ],
	[ 121.48046875, 31.25390625 ],
	[ 121.482421875, 31.2509765625 ],
	[ 121.48046875, 31.25 ],
	[ 121.4814453125, 31.248046875 ],
	[ 121.4833984375, 31.2421875 ],
	[ 121.48046875, 31.240234375 ],
	[ 121.4765625, 31.2421875 ],
	[ 121.4697265625, 31.2392578125 ],
	[ 121.4638671875, 31.2421875 ],
	[ 121.466796875, 31.2353515625 ] ]*/
if(mergedCoordinates.length>0)
{
	let encodedMergedCoordinates = encodePolygon(mergedCoordinates);
	console.log('encodedMergedCoordinates:', encodedMergedCoordinates);
	// encodedMergedCoordinates: { coordinate: '@@DOACU@BGSGQCELAJABIECBBNFHJB\\PABDF@FB@@DC@BHOVUJCFIGA@@RCJBNG@ABBDBB@DNBAJJ@@FB@@H@@@DF@ENB@BDD@BAT@BENDFDPB@AF@@G@AASG@BOCKCEBA@G@KBEDCLMVQ@EACDECABCDKECGDMEKFFM', encodeOffsets: [ 124382, 31984 ] }
}

// 此删除公共边，合并坐标数组的过程不具备通用性，必要时需要手工处理部分坐标
function mergeCoordinates(coordinates1, coordinates2)
{
	let indexs1 = [];
	let indexs2 = [];
	for(let [key1, [coordinateX1, coordinateY1]] of coordinates1.entries())
	{
		for(let [key2, [coordinateX2, coordinateY2]] of coordinates2.entries())
		{
			if(coordinateX1===coordinateX2 && coordinateY1===coordinateY2)
			{
				console.log('sameCoordinates:', [coordinateX1, coordinateY1]);
				console.log(`coordinates1[${key1}]`);
				console.log(`coordinates2[${key2}]`);
				indexs1.push(key1);
				indexs2.push(key2);
				break;
			}
		}
	}
	
	if(indexs1.length<=1)
	{
		console.log('没有公共边，无法合并');
		return []
	}
	else
	{
		console.log('多边形合并');
		let mergedCoordinates = [...coordinates1.slice(0, indexs1[0]), ...coordinates2.slice(indexs2[0] + 1), ...coordinates2.slice(0, indexs2[indexs2.length - 1] + 1), ...coordinates1.slice(indexs1[indexs2.length - 1] + 1)];
		console.log('coordinates1.length：', coordinates1.length);
		console.log('coordinates2.length：', coordinates2.length);
		console.log('mergedCoordinates.length：', mergedCoordinates.length);
		return mergedCoordinates
	}
}


